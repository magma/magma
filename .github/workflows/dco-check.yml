name: DCO check
on:  # yamllint disable-line rule:truthy
  # Use pull_request_target to gain write permissions.
  # Ref: https://github.blog/2020-08-03-github-actions-improvements-for-fork-and-pull-request-workflows/
  pull_request_target:
    types: [opened, reopened, synchronize]

jobs:
  dco_check_job:
    runs-on: ubuntu-latest
    name: DCO Check
    steps:
    - name: DCO Check
      uses: nadock/verified_commits_check@v1
    - name: DCO comment on PR
      if: failure()
      uses: actions/github-script@v3
      with:
        script: |
          var msg = `Oops! Looks like you failed the \`DCO check\`. Be sure to sign all your commits.

          ### Howto

          - [Magma guidelines on signing commits](https://magma.github.io/magma/docs/next/contributing/contribute_workflow#guidelines)
          - [About the \`signoff\` feature](https://stackoverflow.com/questions/1962094/what-is-the-sign-off-feature-in-git-for)
          - [Howto: sign-off most-recent commit](https://stackoverflow.com/questions/13043357/git-sign-off-previous-commits)
          - [Howto: sign-off multiple past commits](https://gist.github.com/kwk/d70f20d17b18c4f3296d)`

          github.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: msg,
          })
