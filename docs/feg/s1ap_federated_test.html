<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>S1AP Federated Integration Test · Magma Documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# S1AP Federated Integration Test"/><meta name="docsearch:version" content="1.8.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="S1AP Federated Integration Test · Magma Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://magma.github.io/magma/"/><meta property="og:description" content="# S1AP Federated Integration Test"/><meta property="og:image" content="https://magma.github.io/magma/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://magma.github.io/magma/img/docusaurus.png"/><link rel="shortcut icon" href="/magma/img/icon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script type="text/javascript" src="/init.js"></script><script src="/magma/js/scrollSpy.js"></script><link rel="stylesheet" href="/magma/css/main.css"/><script src="/magma/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/magma/"><img class="logo" src="/magma/img/magma-logo.svg" alt="Magma Documentation"/><h2 class="headerTitleWithLogo">Magma Documentation</h2></a><a href="/magma/versions"><h3>1.8.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://magmacore.org" target="_self">Magma Website</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="/magma/" target="_self">Docs</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://github.com/magma" target="_self">Code</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://github.com/magma/magma/wiki/Contributor-Guide" target="_self">Contributing</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://wiki.magmacore.org/" target="_self">Wiki</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="s1ap-federated-integration-test"></a><a href="#s1ap-federated-integration-test" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>S1AP Federated Integration Test</h1>
<p>The S1AP Integration Test only tests the AGW. The objective of the <strong>S1AP
Federated Integration Test</strong> is to provide a test platform
to run Magma with all of its components. That is, an end-to-end test with all
components of Magma: AGW, Orc8r and FeG.</p>
<p>Currently, this test is in an experimental phase, so we are only testing the connectivity of
AGW - Orc8r - FeG, and we are able to run an attach/detach test using the S1AP tester
and our mock HSS.</p>
<h2><a class="anchor" aria-hidden="true" id="architecture"></a><a href="#architecture" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Architecture</h2>
<p>As the diagram indicates, this test spins up <strong>AGW</strong>, <strong>FeG</strong>, and <strong>Orc8r</strong>
and uses <code>S1AP</code> and <code>magma_trfserver</code> as an eNb and SGi emulator to run tests.</p>
<div class="mermaid">graph LR;
    A[[S1AP]] --- AGW ---|control| Orc8r --- FeG --- HSS[(HSS)];
    AGW ---|data| Z[[magma_trfserver]];
</div><p>The services will run either on Vagrant VMs or on Docker:</p>
<table>
<thead>
<tr><th>Services</th><th style="text-align:center">Vagrant VM</th><th style="text-align:center">Docker</th></tr>
</thead>
<tbody>
<tr><td>AGW</td><td style="text-align:center">magma</td><td style="text-align:center"></td></tr>
<tr><td>FeG</td><td style="text-align:center"></td><td style="text-align:center">✓</td></tr>
<tr><td>Orc8r</td><td style="text-align:center"></td><td style="text-align:center">✓</td></tr>
<tr><td>Traffic server</td><td style="text-align:center">magma_trfserver</td><td style="text-align:center"></td></tr>
<tr><td>S1AP tester</td><td style="text-align:center">magma_test</td><td style="text-align:center"></td></tr>
<tr><td>HSS</td><td style="text-align:center"></td><td style="text-align:center">✓</td></tr>
</tbody>
</table>
<h2><a class="anchor" aria-hidden="true" id="running-the-tests"></a><a href="#running-the-tests" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running the tests</h2>
<p>Below there are three different ways to run the tests. These will help you
debug any intermediate step should the automation fail.</p>
<h3><a class="anchor" aria-hidden="true" id="automated-test-run"></a><a href="#automated-test-run" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Automated test run</h3>
<p>The fab script mentioned below will do everything for you. In case it fails, try one of the other two methods:
<a href="#semiautomatic-test-run">semiautomatic</a> or <a href="#manual-build">manual</a>.</p>
<p>This script will</p>
<ul>
<li>Build AGW, Orc8r and FeG</li>
<li>Start AGW, Orc8r and FeG</li>
<li>Configure Orc8r with AGW and FeG</li>
<li>Run connectivity tests between all three components</li>
<li>Run a basic attach/detach test</li>
</ul>
<p>To execute the script, run:</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> magma/lte/gateway
fab federated_integ_test:build_all=True

<span class="hljs-comment"># to run it again, you can skip the build_all</span>
<span class="hljs-comment"># however, if you change code in Magma, you will need to build_all again</span>
fab federated_integ_test
</code></pre>
<p>You can access Orc8r adding to your keychain the <code>admin_operator.pfx</code> cert
you will find at <code>/magma/.cache/test_certs</code>. Then you can check your
provisioned gateways using
<a href="https://127.0.0.1:9443/apidocs/v1/?docExpansion=none">swagger interface</a>
that will be running on your Orc8r</p>
<p>Please, for more detail, check the following sections which provide more
insight about this process.</p>
<h3><a class="anchor" aria-hidden="true" id="semiautomatic-test-run"></a><a href="#semiautomatic-test-run" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Semiautomatic test run</h3>
<h4><a class="anchor" aria-hidden="true" id="build-environment"></a><a href="#build-environment" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Build environment</h4>
<p>Using this method, you will build the environment step by step but still using
certain automation. If you want to build the environment manually instead, go to
<a href="#manual-build">Manual build</a>.</p>
<p>On your host machine, execute these commands to build, start and configure the AGW,
FeG and Orc8r:</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> magma/lte/gateway/python/integ_tests/federated_tests
fab build_all_and_configure
</code></pre>
<p>After this has run, you can check
whether your gateways have been bootstrapped using the magmad logs on the AGW and FeG. The
command below will try to reach Orc8r from AGW and FeG, and FeG from AGW:</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> magma/lte/gateway/python/integ_tests/federated_tests
fab test_connectivity
</code></pre>
<p>Once it has been built, start the <code>magma_trfserver</code> and <code>magma_test</code> VMs:</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> magma/lte/gateway
vagrant up magma_test
vagrant up magma_trfserver
</code></pre>
<p>You can then <a href="#run-test-manually">run the test manually</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="manual-build"></a><a href="#manual-build" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Manual build</h3>
<p>If you want to build the environment manually, you can carry out the following steps.</p>
<p><em>Note that commands for the AGW have to be run inside the Vagrant VM. For this reason,
all such commands include the <code>vagrant ssh magma</code> command first. To leave
Vagrant, just type <code>exit</code>. FeG and Orc8r will need to be run on the
host itself (no Vagrant involved).</em></p>
<ul>
<li>AGW:</li>
</ul>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> magma/lte/gateway
vagrant up magma
vagrant ssh magma

<span class="hljs-comment"># inside vagrant vm</span>
<span class="hljs-built_in">cd</span> magma/lte/gateway
make run

<span class="hljs-comment"># exit from vagrant vm</span>
<span class="hljs-built_in">exit</span>
</code></pre>
<ul>
<li>FeG:</li>
</ul>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> magma/lte/gateway/python/integ_tests/federated_tests/docker
docker-compose build
docker-compose up -d
</code></pre>
<ul>
<li>Orc8r:</li>
</ul>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> magma/orc8r/cloud/docker
./build.py -a
./run.py

<span class="hljs-comment"># return to agw folder</span>
<span class="hljs-built_in">cd</span> magma/lte/gateway
<span class="hljs-comment"># register gateways</span>
fab --fabfile=dev_tools.py register_federated_vm
fab --fabfile=dev_tools.py register_feg_gw
</code></pre>
<ul>
<li>Test VM:</li>
</ul>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> magma/lte/gateway
vagrant up magma_test
vagrant ssh magma_test

<span class="hljs-comment"># inside vagrant vm</span>
<span class="hljs-built_in">cd</span> magma/lte/gateway/python
make

<span class="hljs-comment"># exit from vagrant vm</span>
<span class="hljs-built_in">exit</span>
</code></pre>
<ul>
<li>Traffic VM:</li>
</ul>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> magma/lte/gateway
vagrant up magma_trfserver
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="run-test-manually"></a><a href="#run-test-manually" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Run test manually</h4>
<p>Once you have built all of the VMs, you can try to run the test from the
<code>magma_test</code> VM. It is a simple attach-detach test:</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> magma/lte/gateway
vagrant ssh magma_test

<span class="hljs-comment"># inside vagrant vm</span>
<span class="hljs-built_in">cd</span> magma/lte/gateway/python/integ_tests
make integ_test TESTS=federated_tests/s1aptests/test_attach_detach.py

<span class="hljs-comment"># once the test is done, you can exit the vagrant vm</span>
<span class="hljs-built_in">exit</span>
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#architecture">Architecture</a></li><li><a href="#running-the-tests">Running the tests</a><ul class="toc-headings"><li><a href="#automated-test-run">Automated test run</a></li><li><a href="#semiautomatic-test-run">Semiautomatic test run</a></li><li><a href="#manual-build">Manual build</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/magma/" class="nav-home"><img src="/magma/img/magma_icon.png" alt="Magma Documentation" width="66"/></a><div><h5>Docs</h5><a href="https://github.com/magma/magma/blob/master/docs/pdfs/Magma_Product_Overview.pdf">Magma Product Overview</a><a href="https://github.com/magma/magma/blob/master/docs/pdfs/Magma_Specs_FFWA_V1.1.pdf">Magma Spec</a></div><div><h5>Community</h5><a href="https://slack.magmacore.org">Slack</a><a href="https://fb.me/magmadevsummit" target="_blank" rel="noreferrer noopener">Magma Dev Summit</a></div><div><h5>More</h5><a href="https://magmacore.org/blog/">Blog</a><a href="https://github.com/magma/magma">GitHub</a></div></section><section class="copyright">Copyright © 2022 The Magma Authors</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'f95caeb7bc059b294eec88e340e5445b',
                indexName: 'magma',
                inputSelector: '#search_input_react'
              });
            </script></body></html>