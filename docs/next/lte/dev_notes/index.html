<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Developer Notes for Access Gateway · Magma</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# Developer Notes for Access Gateway"/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Developer Notes for Access Gateway · Magma"/><meta property="og:type" content="website"/><meta property="og:url" content="https://facebookincubator.github.io/magma/"/><meta property="og:description" content="# Developer Notes for Access Gateway"/><meta property="og:image" content="https://facebookincubator.github.io/magma/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://facebookincubator.github.io/magma/img/docusaurus.png"/><link rel="shortcut icon" href="/magma/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/magma/js/scrollSpy.js"></script><link rel="stylesheet" href="/magma/css/main.css"/><script src="/magma/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/magma/"><img class="logo" src="/magma/img/fb.png" alt="Magma"/><h2 class="headerTitleWithLogo">Magma</h2></a><a href="/magma/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/magma/docs/next/basics/introduction" target="_self">Docs</a></li><li class=""><a href="/magma/help" target="_self">Help</a></li><li class=""><a href="https://github.com/facebookincubator/magma" target="_self">Github</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>AGW Development</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Basics<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/docs/next/basics/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/basics/prerequisites">Prerequisites</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/basics/quick_start_guide">Quick Start Guide</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Orchestrator<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Deploying Orchestrator</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/deploy_intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/deploy_build">Building Orchestrator</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/deploy_install">Installing Orchestrator</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/orc8r/deploy_upgrade">Upgrading from 1.0</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">NMS User Guide<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/nms_organizations">Multi-Tenancy (Organizations)</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/nms/nms_grafana">Custom Grafana Dashboards</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Access Gateway<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Deploying AGWs</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/setup_deb">Setup (Bare Metal)</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/config_agw">AGW Configuration</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/enodebd">eNodeB Configuration</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/agw_110_upgrade">Upgrading from 1.0</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">AGW Development</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/tr069">Adding TR-069 support for an eNodeB</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/lte/s1ap_tests">S1AP Integration Tests</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/magma/docs/next/lte/dev_notes">Developer Notes for Access Gateway</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Federation Gateway<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Deploying FeG</h4><ul><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/deploy_intro">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/deploy_build">Building Federation Gateway</a></li><li class="navListItem"><a class="navItem" href="/magma/docs/next/feg/deploy_install">Installing Federation Gateway</a></li></ul></div></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="developer-notes-for-access-gateway"></a><a href="#developer-notes-for-access-gateway" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Developer Notes for Access Gateway</h1>
<p>This section provides a guide for anyone testing existing features,
fixing a bug or adding a new feature to the Access Gateway. All developers are
highly encouraged to maintain this guide to make sure it is up to date and
continues to grow.</p>
<h2><a class="anchor" aria-hidden="true" id="configurationsystem-settings"></a><a href="#configurationsystem-settings" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration/system settings</h2>
<p>If you have a gateway running in a VM (as described in the <a href="../basics/quick_start_guide">Quick Start
Guide</a>), the <code>magma</code> directory is shared between
the guest and host machine, so changes made on either system reflect on the
other.  Exceptions to this rule are the systemd unit files and python scripts.
Changes to these files on the guest or host need to be manually synced.</p>
<h3><a class="anchor" aria-hidden="true" id="configuration-filesdirectories"></a><a href="#configuration-filesdirectories" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration files/directories</h3>
<ul>
<li><code>/etc/magma/</code>: location of default configurations and templates for all
services</li>
<li><code>/etc/magma/gateway.mconfig</code>: main file that contains the configuration for
all services, as exposed via the Orc8r API</li>
<li><code>/var/opt/magma/configs/gateway.mconfig</code>: For gateways connected to an
orchestrator, the configuration from Orc8r is periodically streamed to the
gateway and written here. This streamed config takes precedence over
<code>/etc/magma/gateway.mconfig</code>.</li>
<li><code>/etc/magma/&lt;service_name&gt;.yml</code>: Service configuration file, in YAML format.
These configurations are local and are not exposed through the API. These
include logging level, local network interface names, etc.</li>
<li><code>/etc/magma/templates/&lt;service_name&gt;.conf.template</code>: This contains the
structured template for the &lt;service_name&gt;.conf file used as input to
some services, such as Control-proxy, Dnsd, MME and Redis.</li>
<li><code>/var/opt/magma/tmp/&lt;service_name&gt;.conf</code>: The configuration file read by
some services, such as Control-proxy, Dnsd, MME and Redis, at start-up. This
file is generated by mapping the configuration values from <code>gateway.mconfig</code> and
<code>&lt;service.yml&gt;</code> to the template defined in <code>&lt;service_name&gt;.conf.template</code>.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="systemd-unit-configuration-files"></a><a href="#systemd-unit-configuration-files" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Systemd unit configuration files</h3>
<ul>
<li><code>/etc/systemd/system/magma@&lt;service_name&gt;.service</code>: Systemd unit
files for Magma service. Note that these files are maintained under
<code>magma/lte/gateway/deploy/roles/magma/files/systemd/</code> and are copied into the
<code>/etc/systemd/system</code> directory of the VM at the time of provisioning. You need
to manually sync changes to these files between guest and host OS.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="python-scripts-to-generate-configs"></a><a href="#python-scripts-to-generate-configs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Python scripts to generate configs</h3>
<ul>
<li><code>generate_&lt;service&gt;_config.py</code>: Scripts that generate the
<code>&lt;service_name&gt;.conf</code> file for some services. These are executed every time
a service starts.
Note that these files are maintained under <code>magma/lte/gateway/python/scripts</code>
and copied to the <code>/usr/local/bin</code> directory in the guest host at the time of
provisioning.  Changes to these scripts need to be manually synced between the
guest and host OS.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="testing"></a><a href="#testing" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Testing</h2>
<h3><a class="anchor" aria-hidden="true" id="connecting-a-physical-enodeb-and-ue-to-gateway-vm"></a><a href="#connecting-a-physical-enodeb-and-ue-to-gateway-vm" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Connecting a physical eNodeB and UE to Gateway VM</h3>
<p>While the <a href="/magma/docs/next/lte/s1ap_tests">S1ap integration tests</a> provide a simulated UE(s) and
eNodeB(s) to test your AGW VM while actively developing, one can extend the
testing to physical UE and eNodeB.
To connect a physical eNodeB to the gateway VM:</p>
<ol>
<li>Connect the eNodeB to a port on the host machine, say it is interface <code>en9</code>.</li>
<li>From the VirtualBox GUI, switch the Adapter 1 (for <code>eth1</code> interface) from
<code>Host-only</code> to <code>Bridged</code> mode and bridge it to interface <code>en9</code> from above.</li>
<li>In gateway VM, modify the <code>nat_iface</code> in <code>/etc/magma/pipelined.yml</code> from
<code>eth2</code> to <code>eth0</code>. Restart all services.</li>
<li>In the gateway VM, follow the steps in <a href="enodebd#basic-troubleshooting">EnodeB
Configuration</a>. Make sure the <code>earfcn</code> set in the
enodebd section of <code>gateway.mconfig</code> is the one that is supported by the eNodeB
under consideration.</li>
</ol>
<p>To connect a physical UE to the gateway VM,</p>
<ol>
<li><p>Use a programmable SIM which is provisioned with the LTE auth key that you
will use in the EPC.</p></li>
<li><p>On the gateway VM, add the subscriber using the CLI:</p></li>
<li><p><code>magtivate</code></p></li>
<li><p><code>subscriber_cli.py add --lte-auth-key &lt;base64 LTE auth key&gt; IMSI&lt;15 digit IMSI&gt;</code></p></li>
<li><p>On the UE, turn airplane mode on, then off, to trigger a fresh attach</p></li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="debugging"></a><a href="#debugging" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Debugging</h2>
<h3><a class="anchor" aria-hidden="true" id="logs"></a><a href="#logs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Logs</h3>
<p>To change the logging level for a particular service, please modify the
<code>log_level</code> in <code>/etc/magma/&lt;service_name&gt;.yml</code></p>
<ul>
<li><p><code>/var/log/syslog</code>: gives a good view of all the Magma services
running on the AGW. This is a good place to check whether the AGW is connecting
to the orchestrator, any GRPC errors or which service is causing a cascaded
crash (e.g. a crash in Sessiond can cause Mme service to terminate).
A good way to filter the logs from individual processes is with <code>journalctl</code>.
For example, to look at logs from SubscriberDb use:
<code>sudo journalctl -fu magma@subscriberdb</code></p></li>
<li><p><code>/var/log/mme.log</code> is a symbolic link that points to the latest log file
created by the MME service. The Mme service creates a new log file with name
<code>MME.magma-dev.root.log.INFO.&lt;date&gt;-&lt;time&gt;.&lt;PID&gt;</code> every time the service is
(re)started. The AGW maintains the 10 most recent log files.</p></li>
<li><p><code>/var/log/enodebd.log</code> contains the logs from Enodebd</p></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="clis"></a><a href="#clis" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CLIs</h3>
<p>Many services have a command line interface (CLI) that can be used for
debugging and configuration. Check the <a href="/magma/docs/next/lte/readme_agw#command-line-interfaces">AGW
Readme</a> for more details.</p>
<h3><a class="anchor" aria-hidden="true" id="analyzing-raw-network-packets"></a><a href="#analyzing-raw-network-packets" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Analyzing raw network packets</h3>
<p>If you want to look at the raw packets sent over the network, <code>tcpdump</code> is a
useful tool to capture and save them to a file. It is not installed
by default on the access gateway, so you need to do <code>sudo apt-get install tcpdump</code> to install it. Next, you can:</p>
<ul>
<li>Capture packets on the eNodeB
interface: <code>sudo tcpdump -i eth1 -w &lt;file_name&gt;</code></li>
<li>Capture packets on all interfaces (filter out SSH traffic so your local SSH
session doesn't bloat the capture): <code>sudo tcpdump -i any &quot;not port 22&quot; -w &lt;file_name&gt;</code></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="analyzing-coredumps"></a><a href="#analyzing-coredumps" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Analyzing coredumps</h3>
<p>If any of the AGW services crash with a segmentation fault, a coredump is
preserved in a directory named <code>core-&lt;timestamp&gt;-&lt;process_name&gt;[-&lt;PID&gt;]</code> under
the <code>/tmp</code> directory on the AGW. For example:</p>
<ul>
<li><code>core-1558015879-ITTI_bundle</code> is a coredump from MME</li>
<li><code>core-1585761965-sessiond-12741_bundle</code> is a coredump from sessiond</li>
<li><code>core-1582710288-python3-17823_bundle</code> is a coredump from a python service
running with PID 17823</li>
</ul>
<p>For the coredumps generated by MME or sessiond, you can read them through <code>gdb</code>,
as follows:</p>
<p><code>cd /tmp/&lt;core-directory&gt;/</code>
<code>gunzip &lt;core gzip file&gt;</code>
<code>gdb /usr/local/bin/&lt;process name&gt; &lt;unzipped core file&gt;</code></p>
<p>From within the gdb shell, <code>bt</code> command will display the backtrace for the
segmentation fault.</p>
<p>TODO: add steps to read coredumps from python services</p>
<h3><a class="anchor" aria-hidden="true" id="running-mme-with-gdb"></a><a href="#running-mme-with-gdb" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running MME with gdb</h3>
<p>If you need to debug MME with gdb, make sure all the services that it is
dependent on are already running. Follow the steps below:</p>
<ol>
<li><code>sudo service magma@magmad start</code></li>
<li><code>sudo service magma@mme stop</code></li>
<li><code>sudo service sctpd start</code></li>
<li><code>sudo service magma@mobilityd start</code></li>
<li><code>sudo service magma@pipelined start</code></li>
<li><code>sudo service magma@sessiond start</code></li>
<li><code>sudo gdb /usr/local/bin/mme</code></li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="checking-redis-entries-for-stateless-services"></a><a href="#checking-redis-entries-for-stateless-services" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Checking Redis entries for stateless services</h3>
<p>When the services are running in stateless mode, as described in <a href="s1ap_tests#testing-stateless-access-gateway">Testing
stateless Access Gateway</a>, you can
connect to the redis service with <code>redis-cli -p 6380</code>. Then on the shell, you
can list all the keys with <code>KEYS *</code>. The keys for state follow the pattern
<code>&lt;IMSI&gt;:&lt;Service/MME task&gt;</code>. For example:</p>
<ul>
<li><code>IMSI001010000000001:SPGW</code> is the state preserved for IMSI
001010000000001 by SPGW task in Mme service</li>
<li>Keys such as <code>spgw_state</code>,<code>s1ap_state</code>,<code>mme_nas_state</code> are used to store
gateway wide state for a particular task in the MME process</li>
<li>Mobilityd stores state with the key <code>mobilityd:sid_to_descriptors</code></li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/magma/docs/next/lte/s1ap_tests"><span class="arrow-prev">← </span><span>S1AP Integration Tests</span></a><a class="docs-next button" href="/magma/docs/next/feg/deploy_intro"><span>Introduction</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#configurationsystem-settings">Configuration/system settings</a><ul class="toc-headings"><li><a href="#configuration-filesdirectories">Configuration files/directories</a></li><li><a href="#systemd-unit-configuration-files">Systemd unit configuration files</a></li><li><a href="#python-scripts-to-generate-configs">Python scripts to generate configs</a></li></ul></li><li><a href="#testing">Testing</a><ul class="toc-headings"><li><a href="#connecting-a-physical-enodeb-and-ue-to-gateway-vm">Connecting a physical eNodeB and UE to Gateway VM</a></li></ul></li><li><a href="#debugging">Debugging</a><ul class="toc-headings"><li><a href="#logs">Logs</a></li><li><a href="#clis">CLIs</a></li><li><a href="#analyzing-raw-network-packets">Analyzing raw network packets</a></li><li><a href="#analyzing-coredumps">Analyzing coredumps</a></li><li><a href="#running-mme-with-gdb">Running MME with gdb</a></li><li><a href="#checking-redis-entries-for-stateless-services">Checking Redis entries for stateless services</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/magma/" class="nav-home"><img src="/magma/img/fb.png" alt="Magma" width="66" height="58"/></a><div><h5>Docs</h5><a href="https://github.com/facebookincubator/magma/blob/master/docs/Magma_Product_Overview.pdf">Magma Product Overview</a><a href="https://github.com/facebookincubator/magma/blob/master/docs/Magma_Specs_V1.1.pdf">Magma Spec</a></div><div><h5>Community</h5><a href="https://discord.gg/4YxZbft">Discord</a><a href="https://fb.me/magmadevsummit" target="_blank" rel="noreferrer noopener">Magma Dev Summit</a></div><div><h5>More</h5><a href="https://code.fb.com/open-source/magma/">Blog</a><a href="https://github.com/facebookincubator/magma">GitHub</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/magma/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2020 Facebook</section></footer></div></body></html>