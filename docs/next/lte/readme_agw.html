<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>AGW Services/Sub-Components · Magma</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# AGW Services/Sub-Components"/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="AGW Services/Sub-Components · Magma"/><meta property="og:type" content="website"/><meta property="og:url" content="https://facebookincubator.github.io/magma/"/><meta property="og:description" content="# AGW Services/Sub-Components"/><meta property="og:image" content="https://facebookincubator.github.io/magma/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://facebookincubator.github.io/magma/img/docusaurus.png"/><link rel="shortcut icon" href="/magma/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/magma/js/scrollSpy.js"></script><link rel="stylesheet" href="/magma/css/main.css"/><script src="/magma/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/magma/"><img class="logo" src="/magma/img/fb.png" alt="Magma"/><h2 class="headerTitleWithLogo">Magma</h2></a><a href="/magma/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/magma/docs/next/basics/introduction" target="_self">Docs</a></li><li class=""><a href="/magma/help" target="_self">Help</a></li><li class=""><a href="https://github.com/facebookincubator/magma" target="_self">Github</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="agw-servicessub-components"></a><a href="#agw-servicessub-components" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AGW Services/Sub-Components</h1>
<h2><a class="anchor" aria-hidden="true" id="mme"></a><a href="#mme" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MME</h2>
<p>MME includes S1AP, NAS and MME_APP subcomponents. MME functions include:</p>
<ol>
<li>S1AP external Interface with eNB
<ol>
<li>S1AP ASN.1 encode/decode</li>
<li>S1AP Procedures</li>
</ol></li>
<li>NAS external Interface with UE
<ol>
<li>NAS message encode/decode</li>
<li>NAS Procedures</li>
<li>NAS state-machine for NAS EMM and NAS ESM protocols</li>
</ol></li>
<li>S11 like Interface with unified S-GW &amp; P-GW
<ol>
<li>Create and delete PDN Sessions</li>
<li>Create/modify/delete default and dedicated bearers</li>
</ol></li>
<li>GRPC based S6a like interface towards FedGW
<ol>
<li>To get authentication vector and subscriber profile to authenticate and authorize the subscriber</li>
<li>To register the serving MME-id with HSS</li>
<li>To receive the HSS initiated subscriber de-registration request</li>
<li>To send purge request to HSS during UE de-registration</li>
<li>To receive HSS reset indication</li>
</ol></li>
<li>GRPC based SGs like interface towards FeGW
<ol>
<li>To support NON-EPS services for the subscriber ( CS voice and CS-SMS)</li>
</ol></li>
<li>Update serving GW-id for the subscriber to the FeGW</li>
<li>Statistics to track the number of eNodeBs connected, number of registered UEs, number of connected UEs and number of idle UEs.</li>
<li>MME APP maintains UE state machine and routes the message to appropriate modules based on UE state, context and received message.</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="s-pgw-control-plane"></a><a href="#s-pgw-control-plane" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>S-PGW Control Plane</h2>
<p>S-PGW Control Plane functions include:</p>
<ol>
<li>S11 like interface Interface with MME
<ol>
<li>Create and delete PDN Sessions</li>
<li>Create/modify/delete default and dedicate bearers</li>
</ol></li>
<li>Interface with MobilityD to allocate and release IP address for the subscriber during PDN connection establishment and release, respectively</li>
<li>Interface with Sessiond/PCEF to trigger Gx and Gy session establishment for the subscriber during PDN connection establishment</li>
<li>Establish and release GTP tunnel during bearer setup and release</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="health-checker"></a><a href="#health-checker" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Health Checker</h2>
<p>Health checker reports 2 kinds of health status:</p>
<ol>
<li>Access Gateway specific health which includes:
<ul>
<li>Number of allocated_ips</li>
<li>Number of core_dumps</li>
<li>Registration_success_rate</li>
<li>Subscriber table</li>
</ul></li>
<li>Generic Health status which includes:
<ul>
<li>Gateway - Controller connectivity</li>
<li>Status for all the running services</li>
<li>Number of restarts per each service</li>
<li>Number of errors per each service</li>
<li>Internet and DNS status</li>
<li>Kernel version</li>
<li>Magma version</li>
</ul></li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="mobilityd"></a><a href="#mobilityd" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mobilityd</h2>
<p>Mobilityd functions include:</p>
<ol>
<li>Interface with orchestrator to receive IP address block during system bring-up.</li>
<li>Allocate and release  IP address for the  subscriber on the request from S-PGW Control Plane.</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="sessiond--pcef"></a><a href="#sessiond--pcef" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sessiond / PCEF</h2>
<p>Sessiond implements the control plane for the PCEF functionality in Magma. Sessiond is responsible for the lifecycle management of the session state (credit and rules) associated with a user. It interacts with the PCEF datapath through pipelined for L2-L4 and DPId for L4-L7 policies.</p>
<h2><a class="anchor" aria-hidden="true" id="pipelined"></a><a href="#pipelined" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pipelined</h2>
<p>Pipelined is the control application that programs the OVS openflow rules. In implementation pipelined is a set of services that are chained together. These services can be chained and enabled/disabled through the REST API.  The README (<a href="https://github.com/facebookincubator/magma/blob/master/README.md">https://github.com/facebookincubator/magma/blob/master/README.md</a>) describes the contract in greater detail.</p>
<h2><a class="anchor" aria-hidden="true" id="policydb"></a><a href="#policydb" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PolicyDB</h2>
<p>PolicyDB is the service that supports static PCRF rules. This service runs in both the AGW and the orchestrator. Rules managed through the rest API are streamed to the policydb instances on the AGW. Sessiond ensures these policies are implemented as specified.</p>
<h2><a class="anchor" aria-hidden="true" id="subscriberdb"></a><a href="#subscriberdb" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Subscriberdb</h2>
<p>Subscriberdb is Magma's local version of HSS. Magma uses Subscriberdb to enable LTE data services through one network node like AGW for LTE subscribers.  It is deactivated for the deployments that make use of the MNO's HSS. It supports the following two S6a procedures:</p>
<ol>
<li>S6a: Authentication Information Request and Answer (AIR/AIA)</li>
<li>S6a: Update Location Request and Answer (ULR/ULA)</li>
</ol>
<p>Subscriberdb functions include:</p>
<ol>
<li>Interface with Orchestrator to receive subscriber information such as IMSI, secret key (K) , OP, user-profile during system bring-up.</li>
<li>Generate Authentication vectors using* *Milenage Algorithm and share these with MME.</li>
<li>Share user profile with MME.</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="ovs---data-path"></a><a href="#ovs---data-path" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OVS - Data path</h2>
<p>OVS (<a href="http://www.openvswitch.org/">http://www.openvswitch.org/</a>) is used to implement basic PCEF functionality for user plane traffic. The control plane applications interacting with OVS are implemented in pipelined.</p>
<h2><a class="anchor" aria-hidden="true" id="enodebd"></a><a href="#enodebd" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Enodebd</h2>
<p>Enodebd supports management of eNodeB devices that use TR-069 as management interface. This is used for both provisioning the eNodeB and collecting the performance metrics.It suppots followig data models:</p>
<ol>
<li>Device Data  model : TR-181 and TR-098</li>
<li>Information Data model : TR-196</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="control-proxy"></a><a href="#control-proxy" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Control Proxy</h2>
<p>Control proxy manages the network transport between the gateways and the controller.</p>
<ol>
<li>Control proxy abstract the service addressability, by providing a service registry which maps a user addressable name to its remote IP and port.</li>
<li>All traffic over HTTP/2, and are encrypted using TLS. The traffic is routed to individual services by encoding the service name in the HTTP/2 :authority: header.</li>
<li>Individual GRPC calls between a gateway and the controller are multiplexed over the same HTTP/2 connection, and this helps to avoid the connection setup time per RPC call.</li>
</ol>
<h1><a class="anchor" aria-hidden="true" id="command-line-interfaces-to-magma-services"></a><a href="#command-line-interfaces-to-magma-services" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Command Line Interfaces to Magma services</h1>
<p>Several services listed above can be configured using CLIs, located under
magma/lte/gateway/python/scripts. These are:</p>
<ol>
<li>Health Checker: agw_health_cli.py</li>
<li>Mobilityd: mobility_cli.py</li>
<li>Sessiond: session_manager_cli.py</li>
<li>Pipelined: pipelined_cli.py</li>
<li>PolicyDB: policydb_cli.py</li>
<li>Subscriberdb: subscriber_cli.py</li>
<li>Enodebd: enodebd_cli.py</li>
</ol>
<p>Each of these CLIs can be used in the gateway VM:</p>
<pre><code class="hljs css language-bash">vagrant@magma-dev:~$ magtivate
(python) vagrant@magma-dev:~$ enodebd_cli.py -h

usage: enodebd_cli.py [-h]
                      {get_parameter,set_parameter,config_enodeb,reboot_enodeb,get_status}
                      ...

Management CLI <span class="hljs-keyword">for</span> Enodebd

optional arguments:
  -h, --<span class="hljs-built_in">help</span>            show this <span class="hljs-built_in">help</span> message and <span class="hljs-built_in">exit</span>

subcommands:
  {get_parameter,set_parameter,config_enodeb,reboot_enodeb,get_status}
    get_parameter       Send GetParameterValues message
    set_parameter       Send SetParameterValues message
    config_enodeb       Configure eNodeB
    reboot_enodeb       Reboot eNodeB
    get_status          Get eNodeB status
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#mme">MME</a></li><li><a href="#s-pgw-control-plane">S-PGW Control Plane</a></li><li><a href="#health-checker">Health Checker</a></li><li><a href="#mobilityd">Mobilityd</a></li><li><a href="#sessiond--pcef">Sessiond / PCEF</a></li><li><a href="#pipelined">Pipelined</a></li><li><a href="#policydb">PolicyDB</a></li><li><a href="#subscriberdb">Subscriberdb</a></li><li><a href="#ovs---data-path">OVS - Data path</a></li><li><a href="#enodebd">Enodebd</a></li><li><a href="#control-proxy">Control Proxy</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/magma/" class="nav-home"><img src="/magma/img/fb.png" alt="Magma" width="66" height="58"/></a><div><h5>Docs</h5><a href="https://github.com/facebookincubator/magma/blob/master/docs/Magma_Product_Overview.pdf">Magma Product Overview</a><a href="https://github.com/facebookincubator/magma/blob/master/docs/Magma_Specs_V1.1.pdf">Magma Spec</a></div><div><h5>Community</h5><a href="https://discord.gg/4YxZbft">Discord</a><a href="https://fb.me/magmadevsummit" target="_blank" rel="noreferrer noopener">Magma Dev Summit</a></div><div><h5>More</h5><a href="https://code.fb.com/open-source/magma/">Blog</a><a href="https://github.com/facebookincubator/magma">GitHub</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/magma/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2020 Facebook</section></footer></div></body></html>