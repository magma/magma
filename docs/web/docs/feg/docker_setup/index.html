<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>FeG Docker Setup · Magma</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h1&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;feg-docker-setup&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#feg-docker-setup&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;FeG Docker Setup&lt;/h1&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="FeG Docker Setup · Magma"/><meta property="og:type" content="website"/><meta property="og:url" content="https://facebookincubator.github.io/magma/web/"/><meta property="og:description" content="&lt;h1&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;feg-docker-setup&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#feg-docker-setup&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;FeG Docker Setup&lt;/h1&gt;
"/><meta property="og:image" content="https://facebookincubator.github.io/magma/web/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://facebookincubator.github.io/magma/web/img/docusaurus.png"/><link rel="shortcut icon" href="/magma/web/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/magma/web/css/main.css"/><script src="/magma/web/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/magma/web/"><img class="logo" src="/magma/web/img/fb.png" alt="Magma"/><h2 class="headerTitleWithLogo">Magma</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/magma/web/docs/basics/introduction" target="_self">Docs</a></li><li class=""><a href="/magma/web/help" target="_self">Help</a></li><li class=""><a href="https://github.com/facebookincubator/magma" target="_self">Github</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Federated Gateway</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Basics<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/web/docs/basics/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/basics/prerequisites">Prerequisites</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/basics/quick_start_guide">Quick Start Guide</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Orchestrator<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/web/docs/orc8r/docker_setup">Docker Setup</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/orc8r/nms_setup">Setting up the NMS</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/orc8r/testing">Testing</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/orc8r/remote_cli">Orchestrator Remote CLI</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/orc8r/rest_apis">Swagger UI for REST APIs</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/orc8r/generic_commands">Generic commands framework</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/orc8r/packer">Packer Build</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Access Gateway<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/web/docs/lte/readme_agw">Services/Sub-Components</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/lte/s1ap_tests">S1AP Integration Tests</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/lte/enodebd">eNodeB Configuration</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/lte/redirectd">Redirection</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/lte/pipelined">Pipelined</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/lte/pipelined_tests">Pipelined testing framework</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/lte/readme_callflow">Building the callflow</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Federated Gateway<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/web/docs/feg/readme">Overview</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/feg/deployment">Packaging, Deployment, and Upgrades</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/feg/faq">FAQ</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/magma/web/docs/feg/docker_setup">FeG Docker Setup</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">How To<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/magma/web/docs/howtos/configurations">Configurations</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/howtos/readme_package">Packaging</a></li><li class="navListItem"><a class="navItem" href="/magma/web/docs/howtos/docusaurus">Docusaurus</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="feg-docker-setup"></a><a href="#feg-docker-setup" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>FeG Docker Setup</h1>
<p><em>NOTE: Docker support for FeG is not yet official</em></p>
<p>The FeG can be run in two different modes: development or production.
The development mode is setup to make tests easy to run and it runs all of the
services in one container. On the other hand, in the production environment,
each service runs in its own container. In production, containers are optimized
for size and so many utilities are removed.</p>
<h2><a class="anchor" aria-hidden="true" id="requirements"></a><a href="#requirements" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Requirements</h2>
<p>To run the FeG with docker, both docker and docker compose must be installed.</p>
<ul>
<li>Follow <a href="https://docs.docker.com/install/">these steps</a> to install docker</li>
<li>Follow <a href="https://docs.docker.com/compose/install/">these steps</a> to install docker compose</li>
</ul>
<p>NOTE: If you are running the FeG on Mac, you will need to increase the memory
limit of the docker daemon to at least 4GB to build the images. Otherwise,
when building the Go image, you may see an error message similar to this:
<code>/usr/local/go/pkg/tool/linux_amd64/link: signal: killed</code>.</p>
<p>The certificates (eg. rootCA.key) are expected to be in the <code>.cache/test_certs</code>
folder. That folder is mounted into the appropriate containers.</p>
<h2><a class="anchor" aria-hidden="true" id="development"></a><a href="#development" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Development</h2>
<p>Follow these steps to run the FeG in a docker container for development:</p>
<ol>
<li><code>cd magma/feg/gateway/docker</code></li>
<li><code>docker-compose up -d</code></li>
<li><code>docker exec -ti feg /bin/bash</code></li>
</ol>
<p>Now, your shell should be inside a container with the source code
and configs mounted. The code can be changed externally, and commands such as
<code>make gen build test precommit run</code> should succeed.
Please run <code>make precommit</code> in this container before submitting a patch.</p>
<p>The development environment has a single container, <code>feg</code>, which is used to
run all of the magma services. Systemd is used for managing the services,
and so it should be set as the init system in <code>magmad.yml</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="production"></a><a href="#production" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Production</h2>
<p>Follow these steps to run the FeG in docker containers for production:</p>
<ol>
<li><code>cd magma/feg/gateway/docker</code></li>
<li><code>docker-compose -f docker-compose.prod.yml up -d</code></li>
</ol>
<p>Each service should now be running in its own docker container. Docker is used
to manage the services, and so it should be set as the init system in
<code>magmad.yml</code>. Also, ensure that <code>enable_systemd_tailer = False</code> in <code>magmad.yml</code>.</p>
<p>To manage the containers the following commands are useful:</p>
<ul>
<li><code>docker-compose -f docker-compose.prod.yml ps</code> (get status of each container)</li>
<li><code>docker-compose -f docker-compose.prod.yml logs -f</code> (tail logs of all containers)</li>
<li><code>docker logs -f &lt;service name&gt;</code> (tail logs of a particular service)</li>
<li><code>docker-compose -f docker-compose.prod.yml down</code> (stop all services)</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="publishing-the-images"></a><a href="#publishing-the-images" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Publishing the images</h2>
<p>To push the production images to a private docker registry, use the following script:</p>
<pre><code class="hljs">[<span class="hljs-regexp">/magma/</span>feg<span class="hljs-regexp">/gateway/</span>docker]$ ..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/orc8r/</span>tools<span class="hljs-regexp">/docker/</span>publish.sh -r &lt;REGISTRY&gt; -i gateway_python
[<span class="hljs-regexp">/magma/</span>feg<span class="hljs-regexp">/gateway/</span>docker]$ ..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/orc8r/</span>tools<span class="hljs-regexp">/docker/</span>publish.sh -r &lt;REGISTRY&gt; -i gateway_go
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/magma/web/docs/feg/faq"><span class="arrow-prev">← </span><span>FAQ</span></a><a class="docs-next button" href="/magma/web/docs/howtos/configurations"><span>Configurations</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#requirements">Requirements</a></li><li><a href="#development">Development</a></li><li><a href="#production">Production</a></li><li><a href="#publishing-the-images">Publishing the images</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/magma/web/" class="nav-home"><img src="/magma/web/img/fb.png" alt="Magma" width="66" height="58"/></a><div><h5>Docs</h5><a href="https://github.com/facebookincubator/magma/blob/master/docs/Magma_Product_Overview.pdf">Magma Product Overview</a><a href="https://github.com/facebookincubator/magma/blob/master/docs/Magma_Specs_V1.1.pdf">Magma Spec</a><a href="https://github.com/facebookincubator/magma/blob/master/docs/Magma_Deployment_Guide_Installing_Magma_V2.pdf">Magma Install Guide</a><a href="https://github.com/facebookincubator/magma/blob/master/docs/Magma_Network_Management_System.pdf">Magma Network Management System</a></div><div><h5>Community</h5><a href="https://discord.gg/4YxZbft">Discord</a><a href="https://groups.google.com/forum/#!forum/magma-dev">Forum</a><a href="http://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a></div><div><h5>More</h5><a href="https://code.fb.com/open-source/magma/">Blog</a><a href="https://github.com/facebookincubator/magma">GitHub</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/magma/web/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2019 Facebook</section></footer></div></body></html>