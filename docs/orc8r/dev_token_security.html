<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>REST API Auth · Magma Documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# REST API Auth"/><meta name="docsearch:version" content="1.8.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="REST API Auth · Magma Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://magma.github.io/magma/"/><meta property="og:description" content="# REST API Auth"/><meta property="og:image" content="https://magma.github.io/magma/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://magma.github.io/magma/img/docusaurus.png"/><link rel="shortcut icon" href="/magma/img/icon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script type="text/javascript" src="/init.js"></script><script src="/magma/js/scrollSpy.js"></script><link rel="stylesheet" href="/magma/css/main.css"/><script src="/magma/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/magma/"><img class="logo" src="/magma/img/magma-logo.svg" alt="Magma Documentation"/><h2 class="headerTitleWithLogo">Magma Documentation</h2></a><a href="/magma/versions"><h3>1.8.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://magmacore.org" target="_self">Magma Website</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="/magma/" target="_self">Docs</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://github.com/magma" target="_self">Code</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://github.com/magma/magma/wiki/Contributor-Guide" target="_self">Contributing</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://wiki.magmacore.org/" target="_self">Wiki</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="rest-api-auth"></a><a href="#rest-api-auth" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>REST API Auth</h1>
<h2><a class="anchor" aria-hidden="true" id="motivation"></a><a href="#motivation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Motivation</h2>
<p>Orc8r’s current northbound security currently uses operator-managed x509 client certificates.
For more information on the current Orc8r current security architecture, read <a href="/magma/docs/orc8r/architecture_security#application-layer-access-control">Security Overview</a> for a general overview.</p>
<p>To improve our security measures and to allow for more fine-grained control over resource access, we added tokens that must be sent along with each REST API request in the header.</p>
<h2><a class="anchor" aria-hidden="true" id="overview"></a><a href="#overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h2>
<p><img src="/magma/docs/assets/orc8r/rest_api_auth_overview.png" alt="rest_api_auth_overview">
For Orc8r’s northbound interface security, all REST API requests must include a client certificate and a <code>&lt;username&gt;:&lt;token&gt;</code> in the Basic Auth header.</p>
<p>To access REST API resources, perform the following steps:</p>
<ol>
<li>Log in with their username and password through the <code>/login</code> endpoint</li>
<li>Copy the token from the response body</li>
<li>Authenticate with their username and token (in lieu of the password field) through the Swagger Authorize tool on the top right corner
<img src="/magma/docs/assets/orc8r/rest_api_auth_3.png" alt="rest_api_auth_3">
<img src="/magma/docs/assets/orc8r/rest_api_auth_4.png" alt="rest_api_auth_4"></li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="bootstrapping-admin-token"></a><a href="#bootstrapping-admin-token" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bootstrapping Admin Token</h2>
<p>The initial admin user and its token can be generated via the accessc CLI.
Exec into your Orc8r application container, then run the command <code>/var/opt/magma/bin/accessc add-admin-token ROOT_USERNAME ROOT_PASSWORD</code>.
This would automatically generate a user that has access to the entirety of the REST API.</p>
<h2><a class="anchor" aria-hidden="true" id="managing-users"></a><a href="#managing-users" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Managing Users</h2>
<p>To create additional users, an admin can use the <code>/user</code> endpoint to create, list, delete, and update users.</p>
<p><em>Note:</em> By default, the newly created user will not have read/write access permissions to any resource.
To give the newly created user access to anything, you must create a token for that user specifying their permissions as specified in the next section.</p>
<h2><a class="anchor" aria-hidden="true" id="managing-tokens"></a><a href="#managing-tokens" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Managing Tokens</h2>
<p>Creating access tokens for users can be done simply using <code>POST /user/{username}/token</code> endpoint by including policies in the response body.
The general schema for creating policies is the following:</p>
<pre><code class="hljs css language-javascript">[
    {
        <span class="hljs-string">"effect"</span>: [<span class="hljs-string">"allow"</span>, <span class="hljs-string">"deny"</span>],
        <span class="hljs-string">"action"</span>: [<span class="hljs-string">"read"</span>, <span class="hljs-string">"write"</span>],
        <span class="hljs-string">"resourcetype"</span>: [<span class="hljs-string">"uri"</span>, <span class="hljs-string">"network_id"</span>, <span class="hljs-string">"tenant_id"</span>],
        <span class="hljs-string">"path"</span>: <span class="hljs-string">""</span>,         <span class="hljs-comment">// filled when resourcetype is uri</span>
        <span class="hljs-string">"resourceids"</span>: []   <span class="hljs-comment">// filled when resourcetype is network_id or tenant_id</span>
    },
]
</code></pre>
<p>An example of the response body for creating an admin token that could read and write to all the endpoints would be the following.
This policy is also the default policy added to the user when bootstrapping the admin token.</p>
<pre><code class="hljs css language-json">[
    {
    <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"ALLOW"</span>,
    <span class="hljs-attr">"action"</span>: <span class="hljs-string">"WRITE"</span>,
    <span class="hljs-attr">"resourceType"</span>: <span class="hljs-string">"URI"</span>,
    <span class="hljs-attr">"path"</span>: <span class="hljs-string">"**"</span>
    }
]
</code></pre>
<p>This is an example for creating a non-admin token where a user is allowed read access to all resources,
denied write access to the networks <code>[network1, network2]</code>:</p>
<pre><code class="hljs css language-json">[
    {
        <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"ALLOW"</span>,
        <span class="hljs-attr">"action"</span>: <span class="hljs-string">"WRITE"</span>,
        <span class="hljs-attr">"resourceType"</span>: <span class="hljs-string">"URI"</span>,
        <span class="hljs-attr">"path"</span>: <span class="hljs-string">"**"</span>,
    },
    {
        <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"DENY"</span>,
        <span class="hljs-attr">"action"</span>: <span class="hljs-string">"WRITE"</span>,
        <span class="hljs-attr">"resourceType"</span>: <span class="hljs-string">"NETWORK_ID"</span>,
        <span class="hljs-attr">"resourceIDs"</span>: [<span class="hljs-string">"test_network1"</span>, <span class="hljs-string">"test_network2"</span>]
    },
]
</code></pre>
<p>This is an example of a tenant-scoped policy where the user is allowed read access to all resources
and allowed write access to the tenants with the IDs of <code>[0, 1, 2]</code> and all the tenants' networks:</p>
<pre><code class="hljs css language-json">[
    {
        <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"ALLOW"</span>,
        <span class="hljs-attr">"action"</span>: <span class="hljs-string">"READ"</span>,
        <span class="hljs-attr">"resourceType"</span>: <span class="hljs-string">"URI"</span>,
        <span class="hljs-attr">"path"</span>: <span class="hljs-string">"**"</span>,
    },
    {
        <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"ALLOW"</span>,
        <span class="hljs-attr">"action"</span>: <span class="hljs-string">"WRITE"</span>,
        <span class="hljs-attr">"resourceType"</span>: <span class="hljs-string">"TENANT_ID"</span>,
        <span class="hljs-attr">"resourceIDs"</span>: [<span class="hljs-string">"0"</span>, <span class="hljs-string">"1"</span>]
    },
]
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="reaching-a-policy-decision"></a><a href="#reaching-a-policy-decision" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reaching a policy decision</h2>
<p>Reaching a policy decision is a multi-step process handled by the certifier service.
The certifier service does the following:</p>
<ol>
<li>Checks if the token is valid (i.e., has the correct token prefix and checksum)</li>
<li>Authenticates the user by ensuring the token is registered with the user</li>
<li>Obtains the policy specified by the token and checks if the user’s request is allowed under the given permissions</li>
</ol>
<p><em>Note:</em> For conflicting entries in the policy (e.g., one policy specifies ALLOW and the other DENY), the DENY effect will take precedent.
For requested resources that do not have any policies addressing it (e.g., if the policy only allowed access to one network the user requests any other network), the policy decision defaults to DENY as well.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#motivation">Motivation</a></li><li><a href="#overview">Overview</a></li><li><a href="#bootstrapping-admin-token">Bootstrapping Admin Token</a></li><li><a href="#managing-users">Managing Users</a></li><li><a href="#managing-tokens">Managing Tokens</a></li><li><a href="#reaching-a-policy-decision">Reaching a policy decision</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/magma/" class="nav-home"><img src="/magma/img/magma_icon.png" alt="Magma Documentation" width="66"/></a><div><h5>Docs</h5><a href="https://github.com/magma/magma/blob/master/docs/pdfs/Magma_Product_Overview.pdf">Magma Product Overview</a><a href="https://github.com/magma/magma/blob/master/docs/pdfs/Magma_Specs_FFWA_V1.1.pdf">Magma Spec</a></div><div><h5>Community</h5><a href="https://slack.magmacore.org">Slack</a><a href="https://fb.me/magmadevsummit" target="_blank" rel="noreferrer noopener">Magma Dev Summit</a></div><div><h5>More</h5><a href="https://magmacore.org/blog/">Blog</a><a href="https://github.com/magma/magma">GitHub</a></div></section><section class="copyright">Copyright © 2022 The Magma Authors</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'f95caeb7bc059b294eec88e340e5445b',
                indexName: 'magma',
                inputSelector: '#search_input_react'
              });
            </script></body></html>