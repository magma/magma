<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Header Enrichment · Magma Documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# Header Enrichment"/><meta name="docsearch:version" content="1.5.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Header Enrichment · Magma Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://magma.github.io/magma/"/><meta property="og:description" content="# Header Enrichment"/><meta property="og:image" content="https://magma.github.io/magma/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://magma.github.io/magma/img/docusaurus.png"/><link rel="shortcut icon" href="/magma/img/icon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script type="text/javascript" src="/init.js"></script><script src="/magma/js/scrollSpy.js"></script><link rel="stylesheet" href="/magma/css/main.css"/><script src="/magma/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/magma/"><img class="logo" src="/magma/img/magma-logo.svg" alt="Magma Documentation"/><h2 class="headerTitleWithLogo">Magma Documentation</h2></a><a href="/magma/versions"><h3>1.5.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://magmacore.org" target="_self">Home</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="/magma/" target="_self">Docs</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://github.com/magma" target="_self">Code</a></li><li class=""><a target="_self"> | </a></li><li class=""><a href="https://magmacore.org/community" target="_self">Community</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="header-enrichment"></a><a href="#header-enrichment" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Header Enrichment</h1>
<p>This feature would allow operators to enable header enrichment for UE HTTP traffic. This way AGW could add subscriber
information to HTTP requests. There could be privacy implication of this feature, so operator should check local
laws before using this feature.
Today AGW would add following parameters to HTTP request:</p>
<ol>
<li>IMSI</li>
<li>MSISDN</li>
</ol>
<p>Following are steps to configure Header enrichment</p>
<h2><a class="anchor" aria-hidden="true" id="1-enable-header-enrichment-feature-for-agw"></a><a href="#1-enable-header-enrichment-feature-for-agw" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. Enable header enrichment Feature for AGW</h2>
<p>There are two option to enable header enrichment:</p>
<ol>
<li><p>Enable it in pipelineD config file
You would need to ssh on the AGW and add following line to pipelineD config file '/etc/magma/pipelined.yml'</p>
<pre><code class="hljs"><span class="hljs-attr">he_enabled:</span> <span class="hljs-literal">true</span>
</code></pre></li>
<li><p>Enable via '/LTE/{Network-id}/{Gateway-id}/' API
You would need to define following parameters for Header enrichment under 'cellular' parameter.</p>
<pre><code class="hljs"><span class="hljs-string">"he_config"</span>: {
   <span class="hljs-string">"enable_header_enrichment"</span>: <span class="hljs-literal">true</span>,

   <span class="hljs-string">"enable_encryption"</span>: <span class="hljs-literal">false</span>,

     <span class="hljs-string">"he_hash_function"</span>: <span class="hljs-string">"MD5"</span>,
       <span class="hljs-string">"hmac_key"</span>: <span class="hljs-string">"Xs21Ncas87"</span>

     <span class="hljs-string">"he_encryption_algorithm"</span>: <span class="hljs-string">"RC4"</span>,
        <span class="hljs-string">"encryption_key"</span>: <span class="hljs-string">"C14r0315v0x"</span>,

     <span class="hljs-string">"he_encoding_type"</span>: <span class="hljs-string">"BASE64"</span>,
 },
</code></pre></li>
</ol>
<ul>
<li>enable_header_enrichment: This would add plain text to HTTP requests</li>
<li>enable_encryption: This would encrypt the data passed in HTTP header. First the data is hashed then encrypted and encoded as per configuration.</li>
<li>he_hash_function: User Data would be hashed using specified algorithm and key from 'hmac_key'.
Supported algorithms: MD5, HEX, SHA256</li>
<li>he_encryption_algorithm: Hashed data is encrypted using specified algorithm and key from 'encryption_key'.
Supported algorithms: &quot;RC4&quot;, &quot;AES256_CBC_HMAC_MD5&quot;, &quot;AES256_ECB_HMAC_MD5&quot;, &quot;GZIPPED_AES256_ECB_SHA1&quot;</li>
<li>he_encoding_type: Encode the UE data using specified algorithm.
Supported algorithms: &quot;BASE64&quot;, &quot;HEX2BIN&quot;</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="2-define-policy-rule"></a><a href="#2-define-policy-rule" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. Define Policy Rule</h2>
<p>You need to define policy that defines flow along with list of URL that needs
header enrichment.</p>
<p>This can be done via NMS. Use 'traffic/policy' Page define egress policy.
Following example show required parameters for Header enrichment rule.</p>
<pre><code class="hljs">{
  <span class="hljs-attr">"flow_list"</span>: [
    {
      <span class="hljs-attr">"action"</span>: <span class="hljs-string">"PERMIT"</span>,
      <span class="hljs-attr">"match"</span>: {
        <span class="hljs-attr">"direction"</span>: <span class="hljs-string">"UPLINK"</span>,
        <span class="hljs-attr">"ip_dst"</span>: {
          <span class="hljs-attr">"address"</span>: <span class="hljs-string">"192.168.0.0/16"</span>,
          <span class="hljs-attr">"version"</span>: <span class="hljs-string">"IPv4"</span>
        },
        <span class="hljs-attr">"ip_proto"</span>: <span class="hljs-string">"IPPROTO_TCP"</span>,
        <span class="hljs-attr">"ip_src"</span>: {
          <span class="hljs-attr">"version"</span>: <span class="hljs-string">"IPv4"</span>
        },
        <span class="hljs-attr">"tcp_dst"</span>: <span class="hljs-number">80</span>
      }
    }
  ],
  <span class="hljs-attr">"header_enrichment_targets"</span>: [
    <span class="hljs-string">"abc.com"</span>
  ],
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"test123"</span>,
  <span class="hljs-attr">"priority"</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">"rating_group"</span>: <span class="hljs-number">1000</span>,
  <span class="hljs-attr">"tracking_type"</span>: <span class="hljs-string">"NO_TRACKING"</span>
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="please-note-this-rule-needs-to-have-single-flow-with-following-parameters"></a><a href="#please-note-this-rule-needs-to-have-single-flow-with-following-parameters" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Please note this rule needs to have single flow with following parameters</h3>
<ol>
<li>Mandatory field: <code>action</code> equals  <code>permit</code>.</li>
<li>Mandatory field: <code>Direction</code> needs to be <code>uplink</code>.</li>
<li>Mandatory field: <code>tcp_dst</code> port needs to be <code>80 (http)</code>.</li>
<li>Mandatory field: <code>ip_dst</code> is IP address range of the HTTP servers.</li>
<li>Mandatory field: <code>header_enrichment_targets</code> which is list of URLs.</li>
<li>Define Policy tracking according to your requirements.</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="3-apply-the-policy-to-subscribers"></a><a href="#3-apply-the-policy-to-subscribers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. Apply the policy to subscribers</h2>
<p>Now apply the rule to subscribers. This can be using by
'/LTE/{network-ID}/Subscribers/{subscriber-id}/' API</p>
<pre><code class="hljs"><span class="hljs-string">"active_policies"</span>: [
    <span class="hljs-string">"test123"</span>
],

</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#1-enable-header-enrichment-feature-for-agw">1. Enable header enrichment Feature for AGW</a></li><li><a href="#2-define-policy-rule">2. Define Policy Rule</a><ul class="toc-headings"><li><a href="#please-note-this-rule-needs-to-have-single-flow-with-following-parameters">Please note this rule needs to have single flow with following parameters</a></li></ul></li><li><a href="#3-apply-the-policy-to-subscribers">3. Apply the policy to subscribers</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/magma/" class="nav-home"><img src="/magma/img/magma_icon.png" alt="Magma Documentation" width="66"/></a><div><h5>Docs</h5><a href="https://github.com/facebookincubator/magma/blob/master/docs/Magma_Product_Overview.pdf">Magma Product Overview</a><a href="https://github.com/facebookincubator/magma/blob/master/docs/Magma_Specs_V1.1.pdf">Magma Spec</a></div><div><h5>Community</h5><a href="https://discord.gg/4YxZbft">Discord</a><a href="https://fb.me/magmadevsummit" target="_blank" rel="noreferrer noopener">Magma Dev Summit</a></div><div><h5>More</h5><a href="https://code.fb.com/open-source/magma/">Blog</a><a href="https://github.com/facebookincubator/magma">GitHub</a></div></section><section class="copyright">Copyright © 2021 The Magma Authors</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'f95caeb7bc059b294eec88e340e5445b',
                indexName: 'magma',
                inputSelector: '#search_input_react'
              });
            </script></body></html>